<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="..\css\LoginStyle.css">
    <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet' type='text/css'>
    <title>DBMoney</title>
</head>
<body>
    <div class="login-box">
        <h3>Bem-vindo!</h3>
        <form action="POST">
            <input type="text" name="cpf" placeholder="CPF" required>
            <input type="password" name="senha" id="password" placeholder="Senha" required>
            <a href="#" id="forgot-password">Esqueceu as credenciais?</a>
            <div class="remember-acess">
                <input type="checkbox" id="remember-acess" name="remember-acess" >
                <label for="remember-acess" id="remember-acess-lb">Salvar credenciais</label>
            </div>
            <input type="submit" value="Acessar">
            <a href="cadastro.html" id="register">Ainda não possui uma conta? Registre-se.</a>
        </form>
    </div>
<script>
    let form = document.querySelector("form");
    function handleSubmitForm(event) {
        event.preventDefault();
        let request = new XMLHttpRequest();
        request.open('POST', 'http://localhost:3000/login');
        request.setRequestHeader('Content-Type', 'application/json');
        request.onload  = function() {
            if (this.status == 200) {
                sessionStorage.setItem('cliente_id', payload['cpf']);
                document.location.href = 'dashboard.html';
            } else {
                let message = "Usuário e/ou senha incorretos!";
                if (message) {
                    alert(message);
                }
            }
        };
        let elements = form.elements;
        let payload = buildPayload(elements);
        request.send(payload);
    }
    function buildPayload(elements) {
        let payload = {};
        for(let i = 0; i < elements.length; i++) {
            if(elements[i].type !== 'checkbox' && elements[i].type !== 'submit') {
                payload[elements[i].name] = elements[i].value;
            }
        }
        let payloadString = JSON.stringify(payload);
        return payloadString;
    }
    form.addEventListener('submit', event => handleSubmitForm(event));
</script>  
</body>
</html>
